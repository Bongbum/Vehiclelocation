<!DOCTYPE html>
<html>
<head>
  <title>Vehicle Tracker</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    #mapid {
      height: 400px;
      width: 400px;
      position: relative; /* You may use absolute if you want to position relative to the whole page */
      top: 100px; /* Moves map down from the top */
      left: 100px; /* Moves map to the right from the left side */
    }
  </style>
</head>
<body>
  <h2>Vehicle Tracker</h2>
  <label for="numberSelect1">Select 1st number:</label>
  <select id="numberSelect1"></select>

  <label for="numberSelect2">Select 2nd number:</label>
  <select id="numberSelect2"></select>

  <div id="mapid"></div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    // Initial map setup
    var mymap = L.map('mapid').setView([0, 0], 2);
    L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
        maxZoom: 18,
        id: 'mapbox/streets-v11',
        accessToken: 'your.mapbox.access.token'
    }).addTo(mymap);

    // Load data from Google Apps Script
    fetch('https://script.google.com/macros/s/your_script_id/exec')
      .then(response => response.json())
      .then(data => {
        // Data processing - Replace '0' with the index of the column in your sheet
        var numbers1 = [...new Set(data.map(item => item[1]))]; // Assuming 1st number is the second column
        var numbers2 = [...new Set(data.map(item => item[2]))]; // Assuming 2nd number is the third column
        
        var select1 = document.getElementById('numberSelect1');
        var select2 = document.getElementById('numberSelect2');
        
        // Populate dropdowns
        numbers1.forEach(num => {
          var option = document.createElement('option');
          option.value = num;
          option.text = num;
          select1.appendChild(option);
        });

        numbers2.forEach(num => {
          var option = document.createElement('option');
          option.value = num;
          option.text = num;
          select2.appendChild(option);
        });

        // Dropdown event listeners
        select1.addEventListener('change', updateMap);
        select2.addEventListener('change', updateMap);

        function updateMap() {
          var selectedNumber1 = select1.value;
          var selectedNumber2 = select2.value;
          
          // Filter data for selected numbers
          var vehicleData = data.filter(item => item[1] === selectedNumber1 && item[2] === selectedNumber2);
          
          // Get latest position - Replace '3' and '4' with the indexes of the latitude and longitude columns in your sheet
          var latestPosition = vehicleData[vehicleData.length - 1];
          
          var lat = latestPosition[3];
          var lon = latestPosition[4];

          // Clear map
          mymap.eachLayer((layer) => {
            if (layer instanceof L.Marker) {
              mymap.removeLayer(layer);
            }
          });

          // Add marker to map
          L.marker([lat, lon]).addTo(mymap).bindPopup(`1st number: ${selectedNumber1}, 2nd number: ${selectedNumber2}`);
        }
      });
  </script>
</body>
</html>